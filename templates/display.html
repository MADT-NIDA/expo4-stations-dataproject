{% extends "base.html" %}

{% block title %}Home{% endblock %}
{% block body_header %}{% endblock %}

{% block content %}
  <section id="" class="light-background">
    <div class="row">
      <div class="col-3">
        <div class="container">
          <h2 class="mb-4">เสียงตอบรับสดๆ จากหน้างาน!</h2>
          <h3 class="mb-4" id="total_scan">มีคนแวะมาทั้งหมด: 0</h2>
          <canvas id="OCL" height="350px"></canvas>
        </div>
        

      </div>
      <div class="col-9">
    <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
      <ol class="carousel-indicators">
        <li data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active"></li>
        <li data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1"></li>
        <li data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2"></li>
        <li data-bs-target="#carouselExampleIndicators" data-bs-slide-to="3"></li>
        <li data-bs-target="#carouselExampleIndicators" data-bs-slide-to="4"></li>
      </ol>
      <div class="carousel-inner">
        <div class="carousel-item active">
          <img class="d-block w-100" src="/static/project/carbonix/Carbon Xchange Pitch Deck Presentation.png" alt="First slide">
        </div>
        <div class="carousel-item">
          <img class="d-block w-100" src="/static/project/lift/MADT7204_Lift.png" alt="Lift">
        </div>
        <div class="carousel-item">
          <img class="d-block w-100" src="/static/project/finsure/logo-image.png" alt="FinSure">
        </div>
        <div class="carousel-item">
          <img class="d-block w-100" src="/static/project/FreshX/image.png" alt="FinSure">
        </div>
        <div class="carousel-item">
          <img class="d-block w-100" src="/static/project/airsniff/image.png" alt="FinSure">
        </div>
      </div>
      <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
      </a>
      <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
      </a>
    </div>
      </div>
      
    </div>

  </section>

  

{% endblock %}

{% block footer %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const el = document.querySelector('#carouselExampleIndicators');
    if (el) {
      new bootstrap.Carousel(el, {
        interval: 5000, // 0.1 วินาที
        ride: 'carousel'
      });
    }

    const ctx = document.getElementById('OCL');
    const chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Carbonix', 'FreshX', 'FinSure',"Lift", "Green Bridge", "AirSniff"],
        datasets: [
          {
            label: 'ดูโปรเจกต์',
            data: [0,0,0,0,0,0],
            backgroundColor: '#f2eb61',
            stack: 'Stack 0'
          },
          {
            label: 'แชท',
            data: [0,0,0,0,0,0],
            backgroundColor: '#68f261',
            stack: 'Stack 0'
          },
          {
            label: 'ถูกใจใช่เลย',
            data: [0,0,0,0,0,0],
            backgroundColor: '#f261d0',
            stack: 'Stack 0'
          }
        ]
      },
      options: {
        indexAxis: 'y',
        responsive: true,
        plugins: {
          legend: {
            position: 'bottom',
          },
        },
        scales: {
          x: {
            stacked: true,
            title: {
              display: true,
              text: 'Population'
            }
          },
          y: {
            stacked: true
          }
        }
      }
    });

    // Simulate data update every 10 seconds
    setInterval(() => {
      fetch("/records/summary")
        .then(response => {
            if (!response.ok) {
                throw new Error("Request failed with status " + response.status);
            }
            return response.json();
        })
        .then(data => {
            
            chart.data.datasets[0].data = data.view
            chart.data.datasets[1].data = data.chat
            chart.data.datasets[2].data = data.love
            document.getElementById("total_scan").textContent = 'มีคนแวะมาทั้งหมด: ' + data.scan;

            chart.update();
        })
        .catch(error => {
            console.error("Error posting to /records/summary:", error);
        });

      // Replace this with your real data-fetching logic

    }, 10000);

    });
</script>

{% endblock %}
